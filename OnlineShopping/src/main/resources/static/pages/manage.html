<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        
        <title>网上杂货商城</title>
        
        <!-- 引入样式 -->
        <link rel="stylesheet" href="../plugins/elementui/index.css">
        <link rel="stylesheet" href="../plugins/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="../css/style.css">
        <script src="../js/vue.js"></script>
        <script src="../plugins/elementui/index.js"></script>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/dashboard.css" rel="stylesheet">
        <script src="../js/axios-0.18.0.js"></script>
        <style type="text/css">
            /* Chart.js */


            @-webkit-keyframes chartjs-render-animation {
                from {
                    opacity: 0.99
                }
                to {
                    opacity: 1
                }
            }

            @keyframes chartjs-render-animation {
                from {
                    opacity: 0.99
                }
                to {
                    opacity: 1
                }
            }

            .chartjs-render-monitor {
                -webkit-animation: chartjs-render-animation 0.001s;
                animation: chartjs-render-animation 0.001s;
            }
        </style>
    </head>
    
    <body>
        <div id="app">
            <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
                <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">欢迎来到网上商城</a>
                <input class="form-control form-control-dark w-100" type="text" placeholder="Search"
                       aria-label="Search">
                <ul class="navbar-nav px-3">
                    <li class="nav-item text-nowrap">
                        <el-dropdown @command="clientLoginOut">
                          <span class="el-dropdown-link">
                            注销<i class="el-icon-arrow-down el-icon--right"></i>
                          </span>
                            <el-dropdown-menu slot="dropdown">
                                <el-dropdown-item command="a">{{this.client.clientName}}</el-dropdown-item>
                            </el-dropdown-menu>
                        </el-dropdown>
                        
                        <style>
                            .el-dropdown-link {
                                cursor: pointer;
                                color: #409EFF;
                            }

                            .el-icon-arrow-down {
                                font-size: 12px;
                            }
                        </style>
                    </li>
                </ul>
            </nav>
            
            <div class="container-fluid">
                <div class="row">
                    <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                        <div class="sidebar-sticky" style="position: fixed">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link active" href="http://localhost:8080/pages/dashboard.html">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24"
                                             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                             stroke-linejoin="round" class="feather feather-home">
                                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                        </svg>
                                        商城
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="http://localhost:8080/pages/cart.html">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24"
                                             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                             stroke-linejoin="round" class="feather feather-file">
                                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                                            <polyline points="13 2 13 9 20 9"></polyline>
                                        </svg>
                                        购物车
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="http://localhost:8080/pages/order.html">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24"
                                             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                             stroke-linejoin="round" class="feather feather-shopping-cart">
                                            <circle cx="9" cy="21" r="1"></circle>
                                            <circle cx="20" cy="21" r="1"></circle>
                                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                        </svg>
                                        订单
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="http://localhost:8080/pages/manage.html">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24"
                                             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                             stroke-linejoin="round" class="feather feather-users">
                                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="9" cy="7" r="4"></circle>
                                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                        </svg>
                                        商家商品管理
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="http://localhost:8080/pages/manage.html">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                             stroke-linecap="round" stroke-linejoin="round"
                                             class="feather feather-users">
                                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="9" cy="7" r="4"></circle>
                                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                        </svg>
                                        商家订单管理
                                    </a>
                                </li>
                            </ul>
                            
                        </div>
                    </nav>
                    
                    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                            <h2>商品管理</h2>
                        </div>
                        
                        <!--搜索框-->
                        <el-form :inline="true" :model="formInline" class="demo-form-inline">
                            
                            <el-form-item label="商品名">
                                <el-input v-model="formInline.title" placeholder="商品名"></el-input>
                            </el-form-item>
                            <el-form-item label="最低价">
                                <el-input v-model="formInline.beginPrice" placeholder="0"></el-input>
                            </el-form-item>
                            <el-form-item label="最高价">
                                <el-input v-model="formInline.endPrice" placeholder="99999"></el-input>
                            </el-form-item>
                            <el-form-item label="商品分类">
                                <el-select v-model="formInline.typeName" placeholder="所有商品">
                                    <el-option label="全部" value=""></el-option>
                                    <el-option label="图书、音像" value="图书、音像"></el-option>
                                    <el-option label="笔记本" value="笔记本"></el-option>
                                    <el-option label="文件管理" value="文件管理"></el-option>
                                    <el-option label="本册/便签" value="本册/便签"></el-option>
                                    <el-option label="笔类" value="笔类"></el-option>
                                    <el-option label="双肩包" value="双肩包"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item>
                                <div align="center">
                                    <el-button type="primary" @click="selectByCondition()">搜索</el-button>
                                    <el-button type="primary" @click="productFormVisible = true">新增</el-button>
                                </div>
                            </el-form-item>
                        </el-form>
                        
                        <!--新增商品的嵌套表单-->
                        <el-dialog title="新增商品" :visible.sync="productFormVisible">
                            <el-form ref="insertProductForm" :model="insertProductForm" label-width="80px">
                                <el-form-item label="分类">
                                    <el-select v-model="insertProductForm.categoryId" placeholder="请选择商品所属类型">
                                        <el-option label="图书、音像" value="1"></el-option>
                                        <el-option label="笔记本" value="2"></el-option>
                                        <el-option label="文件管理" value="3"></el-option>
                                        <el-option label="本册/便签" value="4"></el-option>
                                        <el-option label="笔类" value="5"></el-option>
                                        <el-option label="双肩包" value="6"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="系列">
                                    <el-input v-model="insertProductForm.itemType"
                                              placeholder="Lenovo Legion Y7000 2020"></el-input>
                                </el-form-item>
                                <el-form-item label="商品名称">
                                    <el-input v-model="insertProductForm.title" placeholder="拯救者Y7000P"></el-input>
                                </el-form-item>
                                <el-form-item label="商品价格">
                                    <el-input v-model="insertProductForm.price" placeholder="6000"></el-input>
                                </el-form-item>
                                <el-form-item label="商品库存">
                                    <el-input v-model="insertProductForm.num" placeholder="6666"></el-input>
                                </el-form-item>
                                <el-form-item label="商家名">
                                    <el-input v-model="insertProductForm.sellerName" readonly="true"></el-input>
                                </el-form-item>
                                <el-form-item label="商品简介">
                                    <el-input type="textarea" v-model="insertProductForm.sellPoint" placeholder="牛的"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="insertProduct()">立即创建</el-button>
                                    <el-button @click="productFormVisible=false">取消</el-button>
                                </el-form-item>
                            </el-form>
                        </el-dialog>
                        
                        <!--商品列表-->
                        <template>
                            <el-table
                                    :data="tableData"
                                    height="500"
                                    border
                                    style="width: 100%">
                                <el-table-column
                                        prop="itemType"
                                        label="商品类型"
                                        width="180"
                                        align="center"
                                        header-align="center">
                                </el-table-column>
                                <el-table-column
                                        prop="title"
                                        label="商品名"
                                        width="440"
                                        align="center"
                                        header-align="center">
                                </el-table-column>
                                <el-table-column
                                        prop="price"
                                        label="价格"
                                        width="120"
                                        align="center"
                                        header-align="center">
                                </el-table-column>
                                <el-table-column
                                        prop="num"
                                        label="库存"
                                        width="120"
                                        align="center"
                                        header-align="center">
                                </el-table-column>
                                <el-table-column
                                        prop="sellerName"
                                        label="商家名"
                                        width="150"
                                        align="center"
                                        header-align="center">
                                </el-table-column>
                                <el-table-column
                                        fixed="right"
                                        label="操作"
                                        width="200"
                                        header-align="center"
                                        align="center">
                                    <template slot-scope="scope">
                                        <el-button @click="showUpdateFrom(scope.row)" type="text" size="medium">编辑
                                        </el-button>
                                        <el-button type="text" size="medium" @click="isDelete(scope.row)">删除</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </template>
    
                        <!--编辑商品信息-->
                        <el-dialog title="编辑商品信息" :visible.sync="updateProductFromVisible">
                            <el-form ref="insertProductForm" :model="updateProductForm" label-width="80px">
                                <el-form-item label="分类">
                                    <el-select v-model="updateProductForm.categoryId" placeholder="请选择商品所属类型">
                                        <el-option label="图书、音像" value="1"></el-option>
                                        <el-option label="笔记本" value="2"></el-option>
                                        <el-option label="文件管理" value="3"></el-option>
                                        <el-option label="本册/便签" value="4"></el-option>
                                        <el-option label="笔类" value="5"></el-option>
                                        <el-option label="双肩包" value="6"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="系列">
                                    <el-input v-model="updateProductForm.itemType"></el-input>
                                </el-form-item>
                                <el-form-item label="商品名称">
                                    <el-input v-model="updateProductForm.title"></el-input>
                                </el-form-item>
                                <el-form-item label="商品价格">
                                    <el-input v-model="updateProductForm.price"></el-input>
                                </el-form-item>
                                <el-form-item label="商品库存">
                                    <el-input v-model="updateProductForm.num"></el-input>
                                </el-form-item>
                                <el-form-item label="商品简介">
                                    <el-input type="textarea" v-model="updateProductForm.sellPoint"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="updateProduct()">确认修改</el-button>
                                    <el-button @click="dialogFormVisible = false">取消</el-button>
                                </el-form-item>
                            </el-form>
                        </el-dialog>
                        
                    </main>
                </div>
            </div>
        </div>
        <!-- Bootstrap core JavaScript
    ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <!--<style>
            .el-dialog__header{
                width: 500px !important;
            }
            .el-dialog__body{
                width: 500px !important;
            }
            .el-input__inner{
                width: 350px !important;
            }
            .el-textarea__inner{
                width: 400px !important;
                height: 80px !important;
            }
            .el-form .el-form-item{
                margin-bottom: 5px;
            }
        </style>-->
        <script type="text/javascript" src="../js/jquery-3.2.1.slim.min.js"></script>
        <script type="text/javascript" src="../js/popper.min.js"></script>
        <script type="text/javascript" src="../js/bootstrap.min.js"></script>
        
        <!-- Icons -->
        <script type="text/javascript" src="../js/feather.min.js"></script>
        <script>
            feather.replace()
        </script>
        
        <!-- Graphs -->
        <script type="text/javascript" src="../js/Chart.min.js"></script>
        <script>
            var vue = new Vue({
                el: "#app",
                data() {
                    return {
                        tableData: [{
                            itemType: '',
                            title: '',
                            price: '',
                            num: '',
                            sellerName: '',
                            sellPoint: ''
                        }],
                        formInline: {
                            id: '',
                            title: '',
                            typeName: '',
                            beginPrice: '',
                            endPrice: '',
                            sellerName: ''
                        },
                        client: {
                            clientName: ''
                        },
                        insertProductForm: {
                            categoryId: '',
                            itemType: '',
                            title: '',
                            price: '',
                            num: '',
                            sellerName: '',
                            sellPoint: '',
                        },
                        updateProductForm:{
                            categoryId: '',
                            itemType: '',
                            title: '',
                            price: '',
                            num: '',
                            sellerName: '',
                            sellPoint: '',
                        },
                        sellerName: '',
                        productFormVisible: false,/*显示新增商品的表单*/
                        updateProductFromVisible: false,/*显示编辑商品的表单*/
                    }
                },
                mounted() {
                    this.getClientInfo();
                },
                methods: {
                    insertProduct() {
                        var _this = this;
                        axios({
                            method: "post",
                            url: "http://localhost:8080/product/insert",
                            data: _this.insertProductForm
                        }).then(function (res) {
                            _this.productFormVisible = false;
                            _this.insertProductForm.categoryId = '';
                            _this.insertProductForm.itemType = '';
                            _this.insertProductForm.title = '';
                            _this.insertProductForm.price = '';
                            _this.insertProductForm.num = '';
                            _this.insertProductForm.sellerName = '';
                            _this.insertProductForm.sellPoint = '';
                            _this.window.location.reload();
     
                        })
                    },
                    showUpdateFrom(row) {
                        this.updateProductFromVisible = true;
                        this.updateProductForm = row;
                    },
                    updateProduct() {
                        var _this = this;
                        axios({
                            method: "post",
                            url: "http://localhost:8080/product/update",
                            data: _this.updateProductForm
                        }).then(function (res) {
                            _this.updateProductFromVisible = false;
                            window.location.reload();
                        })
                    },
                    isDelete(row) {
                        this.$confirm('删除后不可恢复, 是否继续?', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }).then(() => {
                            this.deleteProductById(row);
                            this.$message({
                                type: 'success',
                                message: '删除成功!'
                            });
                            window.location.reload();
                        }).catch(() => {
                            this.$message({
                                type: 'info',
                                message: '已取消删除'
                            });
                        });
                    },
                    deleteProductById(row) {
                        var _this = this;
                        axios({
                            method: "post",
                            url: "http://localhost:8080/product/delete",
                            data: row
                        }).then(function () {
                        
                        })
                    },
                    clearCookie() {
                        var keys = document.cookie.match(/[^ =;]+(?=\=)/g);
                        if (keys) {
                            for (var i = keys.length; i--;) {
                                document.cookie = keys[i] + '=0;path=/;expires=' + new Date(0).toUTCString();//清除当前域名下的,例如：m.kevis.com
                                document.cookie = keys[i] + '=0;path=/;domain=' + document.domain + ';expires=' + new Date(0).toUTCString();//清除当前域名下的,例如 .m.kevis.com
                                document.cookie = keys[i] + '=0;path=/;domain=kevis.com;expires=' + new Date(0).toUTCString();//清除一级域名下的或指定的,例如 .kevis.com
                            }
                        }
                        console.log('已清除');
                    },
                    clientLoginOut(command) {
                        var _this = this;
                        if (command == 'a') {
                            axios({
                                method: "get",
                                url: "http://localhost:8080/user/userLoginOut"
                            }).then(function (res) {
                                alert(res.data.message);
                                _this.clearCookie();//删除所有cookie取消自动登录
                                window.location.reload();
                            })
                        } else {
                            axios({
                                method: "get",
                                url: "http://localhost:8080/seller/sellerLoginOut"
                            }).then(function (res) {
                                alert(res.data.message);
                                window.location.reload();
                            })
                        }
                    },
                    getClientInfo() {
                        var _this = this;
                        axios({
                            method: "get",
                            url: "http://localhost:8080/user/getUserInfo"
                        }).then(function (res) {
                            if (res.data.userInfo != "not_exists") {
                                _this.client.clientName = "用户：" + res.data.userInfo;
                            } else {
                                _this.getSellerInfo();
                            }
                            
                        })
                    },
                    getSellerInfo() {
                        var _this = this;
                        axios({
                            method: "get",
                            url: "http://localhost:8080/seller/getSellerInfo"
                        }).then(function (res) {
                            _this.formInline.sellerName = res.data.sellerInfo;
                            _this.insertProductForm.sellerName = res.data.sellerInfo;//获取商家名
                            _this.client.clientName = "商家：" + res.data.sellerInfo;
                            _this.selectAllBySeller();
                        })
                    },
                    selectAllBySeller() {
                        var _this = this;
                        axios({
                            method: "post",
                            url: "http://localhost:8080/product/seller",
                            data: _this.formInline
                        }).then(function (res) {
                                //console.log("1111111111" + _this.formInline.id)
                                _this.tableData = res.data
                            }
                        )
                    },
                    selectByCondition() {
                        var _this = this;
                        axios({
                            method: "post",
                            url: "http://localhost:8080/product/condition",
                            data: _this.formInline
                        }).then(function (res) {
                                console.log(res.data)
                                _this.tableData = res.data
                            }
                        )
                    }
                }
            })
        </script>
    </body>
</html>